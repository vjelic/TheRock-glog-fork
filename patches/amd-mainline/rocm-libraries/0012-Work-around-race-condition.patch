From 0e0efad44628e979ce6076ddb0ad7e193cb42a2f Mon Sep 17 00:00:00 2001
From: Marius Brehler <marius.brehler@amd.com>
Date: Fri, 21 Mar 2025 17:01:20 +0000
Subject: [PATCH 12/17] Work around race condition
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

With `add_dependency`, compiling the `hipblas_fortran_client` target
fails with "Cannot open module file ‘hipblas.mod’ for reading at (1): No
such file or directory" as `hipblas.mod` is created in parallel but not
in time for the first run. Using `target_link_libraries` resovles this.
---
 projects/hipblas/clients/CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/projects/hipblas/clients/CMakeLists.txt b/projects/hipblas/clients/CMakeLists.txt
index b5e4eb0fb6..41364efb12 100644
--- a/projects/hipblas/clients/CMakeLists.txt
+++ b/projects/hipblas/clients/CMakeLists.txt
@@ -118,7 +118,7 @@ if( BUILD_CLIENTS_TESTS OR BUILD_CLIENTS_BENCHMARKS OR BUILD_CLIENTS_SAMPLES )
     else()
       add_library(hipblas_fortran_client STATIC ${hipblas_f90_source_clients_no_solver})
     endif()
-    add_dependencies(hipblas_fortran_client hipblas_fortran)
+    target_link_libraries(hipblas_fortran_client hipblas_fortran)
   endif()
   include_directories(${CMAKE_BINARY_DIR}/include/hipblas)
   include_directories(${CMAKE_BINARY_DIR}/include)
-- 
2.43.0

