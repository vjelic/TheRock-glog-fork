From e99b781d690705c13453735c077ddea67edd9eef Mon Sep 17 00:00:00 2001
From: Scott Todd <scott.todd0@gmail.com>
Date: Thu, 6 Mar 2025 15:16:19 -0800
Subject: [PATCH 05/17] Update 'packaging' in pip venv to stabilize setuptools.

When using setuptools>=71.0.0 and packaging<22.0, setuptools may fail with `TypeError: canonicalize_version() got an unexpected keyword argument 'strip_trailing_zero'`.
---
 projects/rocblas/cmake/virtualenv.cmake | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/projects/rocblas/cmake/virtualenv.cmake b/projects/rocblas/cmake/virtualenv.cmake
index 951755aeea..7c9c6cd10d 100644
--- a/projects/rocblas/cmake/virtualenv.cmake
+++ b/projects/rocblas/cmake/virtualenv.cmake
@@ -59,6 +59,15 @@ function(virtualenv_install)
         endif()
     endif()
 
+    message("${VIRTUALENV_BIN_DIR}/${VIRTUALENV_PYTHON_EXENAME} -m pip install --upgrade packaging")
+    execute_process(
+        RESULT_VARIABLE rc
+        COMMAND ${VIRTUALENV_BIN_DIR}/${VIRTUALENV_PYTHON_EXENAME} -m pip install --upgrade packaging
+    )
+    if(rc)
+        message(FATAL_ERROR ${rc})
+    endif()
+
     message("${VIRTUALENV_BIN_DIR}/${VIRTUALENV_PYTHON_EXENAME} -m pip install ${ARGN}")
     execute_process(
       RESULT_VARIABLE rc
-- 
2.43.0

