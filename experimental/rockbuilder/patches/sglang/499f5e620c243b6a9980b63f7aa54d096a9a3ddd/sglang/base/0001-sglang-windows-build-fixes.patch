From eb90062da2930db0b9053f8d909723a2c0f361b7 Mon Sep 17 00:00:00 2001
From: Mika Laitio <mika.laitio@amd.com>
Date: Wed, 4 Jun 2025 23:41:07 -0700
Subject: [PATCH 1/3] sglang windows build fixes

Signed-off-by: Mika Laitio <mika.laitio@amd.com>
---
 sgl-kernel/setup_rocm.py | 38 ++++++++++++++++++++++++++------------
 1 file changed, 26 insertions(+), 12 deletions(-)

diff --git a/sgl-kernel/setup_rocm.py b/sgl-kernel/setup_rocm.py
index b230abfa..0c42dbe8 100644
--- a/sgl-kernel/setup_rocm.py
+++ b/sgl-kernel/setup_rocm.py
@@ -49,18 +49,32 @@ cxx_flags = ["-O3"]
 libraries = ["hiprtc", "amdhip64", "c10", "torch", "torch_python"]
 extra_link_args = ["-Wl,-rpath,$ORIGIN/../../torch/lib", f"-L/usr/lib/{arch}-linux-gnu"]
 
-hipcc_flags = [
-    "-DNDEBUG",
-    f"-DOPERATOR_NAMESPACE={operator_namespace}",
-    "-O3",
-    "-Xcompiler",
-    "-fPIC",
-    "-std=c++17",
-    "-D__HIP_PLATFORM_AMD__=1",
-    "--amdgpu-target=gfx942",
-    "-DENABLE_BF16",
-    "-DENABLE_FP8",
-]
+is_dos = any(platform.win32_ver())
+if is_dos:
+    hipcc_flags = [
+        "-DNDEBUG",
+        f"-DOPERATOR_NAMESPACE={operator_namespace}",
+        "-O3",
+        "-Xcompiler",
+        "-std=c++17",
+        "-D__HIP_PLATFORM_AMD__=1",
+        "--amdgpu-target=gfx942",
+        "-DENABLE_BF16",
+        "-DENABLE_FP8",
+    ]
+else:
+    hipcc_flags = [
+        "-DNDEBUG",
+        f"-DOPERATOR_NAMESPACE={operator_namespace}",
+        "-O3",
+        "-Xcompiler",
+        "-fPIC",
+        "-std=c++17",
+        "-D__HIP_PLATFORM_AMD__=1",
+        "--amdgpu-target=gfx942",
+        "-DENABLE_BF16",
+        "-DENABLE_FP8",
+    ]
 
 ext_modules = [
     CUDAExtension(
-- 
2.43.0

